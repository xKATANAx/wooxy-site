<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WOOXY ADMIN CONTROL</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>

    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyB6XlCbPxs6I1jJThZ6OTiaJ-Xssw_mkbA",
        authDomain: "wooxyproject.firebaseapp.com",
        databaseURL: "https://wooxyproject-default-rtdb.firebaseio.com/",
        projectId: "wooxyproject",
        storageBucket: "wooxyproject.firebasestorage.app",
        messagingSenderId: "932458468968",
        appId: "1:932458468968:web:ca0e8230bfae415f3c8ddd",
        measurementId: "G-VX1QEJZXQW"
      };
      firebase.initializeApp(firebaseConfig);
      const db = firebase.database();
    </script>

    <style>
        /* CSS KÄ±sÄ±mlarÄ±n AynÄ± KalÄ±yor (BozmadÄ±m) */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { background-color: #0d0d0d; color: white; font-family: 'Segoe UI', sans-serif; min-height: 100vh; display: flex; flex-direction: column; }
        .admin-layout { display: flex; min-height: 100vh; width: 100%; }
        .sidebar { width: 260px; background-color: #111; display: flex; flex-direction: column; border-right: 1px solid #222; padding-top: 20px; flex-shrink: 0; }
        .radio-container { --main-color: #fffb00; --main-color-opacity: rgba(255, 255, 255, 0.2); position: relative; display: flex; flex-direction: column; }
        .radio-container input { cursor: pointer; appearance: none; height: 60px; width: 100%; z-index: 2; }
        .radio-container label { position: absolute; left: 50px; height: 60px; display: flex; align-items: center; color: #888; pointer-events: none; z-index: 3; transition: 0.3s; }
        input#radio-data + label { top: 0; }
        input#radio-veriler + label { top: 60px; }
        input#radio-updates + label { top: 120px; }
        .radio-container input:checked + label { color: var(--main-color); font-weight: bold; }
        .glider-container { position: absolute; left: 0; top: 0; width: 100%; height: 180px; pointer-events: none; }
        .glider { position: absolute; height: 60px; width: 100%; background: linear-gradient(90deg, var(--main-color-opacity) 0%, transparent 100%); border-left: 4px solid var(--main-color); transition: transform 0.5s cubic-bezier(0.37, 1.95, 0.66, 0.56); }
        .radio-container input:nth-of-type(1):checked ~ .glider-container .glider { transform: translateY(0); }
        .radio-container input:nth-of-type(2):checked ~ .glider-container .glider { transform: translateY(60px); }
        .radio-container input:nth-of-type(3):checked ~ .glider-container .glider { transform: translateY(120px); }
        .content { flex: 1; padding: 40px; background: #0a0a0a; overflow-y: auto; position: relative; }
        .tab-content { display: none !important; min-height: 100%; padding-bottom: 100px; }
        .tab-content.active { display: block !important; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        h3 { color: #ffffff; margin-bottom: 20px; border-bottom: 1px solid #222; padding-bottom: 10px; }
        .card { background: #161616; padding: 18px; border-radius: 12px; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; border: 1px solid #222; }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-right: 5px; }
        .status-online { background-color: #48ff00; box-shadow: 0 0 8px #48ff00; }
        .status-offline { background-color: #ff4d4d; }
        .btn { padding: 8px 15px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn-ban { background: #ff4d4d; color: white; }
        .btn-white { background: #48ff00; color: black; }
        .btn-admin { background: #fffb00; color: black; }
        #confirmModal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.96); z-index:1000; flex-direction:column; align-items:center; justify-content:center; gap:20px; }
        .confirm-btn-style { display: inline-block; width: 280px; height: 60px; border-radius: 10px; border: 1px solid #1a5e03; position: relative; background-color: #0d0d0d; cursor: pointer; color: white; font-weight: bold; }
        .danger-btn { border-color: #5e0303; }
    </style>
</head>
<body>

    <div class="admin-layout">
        <aside class="sidebar">
            <h2 style="text-align: center; font-size: 1rem; color: #fffb00; margin-bottom: 15px;">WOOXY PANEL</h2>
            <div class="radio-container">
                <input checked id="radio-data" name="radio" type="radio" onclick="switchTab('data')" />
                <label for="radio-data">Data Bilgileri</label>
                <input id="radio-veriler" name="radio" type="radio" onclick="switchTab('veriler')" />
                <label for="radio-veriler">Veriler (Blacklist)</label>
                <input id="radio-updates" name="radio" type="radio" onclick="switchTab('updates')" />
                <label for="radio-updates">GÃ¼ncellemeler</label>
                <div class="glider-container"><div class="glider"></div></div>
            </div>
            <button onclick="location.href='index.html'" style="margin-top:auto; background:none; color:red; border:1px solid red; padding:10px; cursor:pointer;">Ã‡Ä±kÄ±ÅŸ Yap</button>
        </aside>

        <main class="content">
            <section id="tab-data" class="tab-content active">
                <h3>ðŸ‘¤ Aktif KullanÄ±cÄ±lar</h3>
                <div id="userListDisplay">YÃ¼kleniyor...</div>
            </section>

            <section id="tab-veriler" class="tab-content">
                <h3>ðŸš« BanlÄ± & Kara Liste</h3>
                <div id="blacklistDisplay">BanlÄ± kullanÄ±cÄ± yok.</div>
            </section>

            <section id="tab-updates" class="tab-content">
                <h3>ðŸ“Š Sistem Ä°statistikleri</h3>
                <p>Firebase Ã¼zerinden canlÄ± takip aktif.</p>
            </section>
        </main>
    </div>

    <div id="confirmModal">
        <h2 id="modalTitle">Ä°ÅžLEMÄ° ONAYLIYOR MUSUNUZ?</h2>
        <button id="modalConfirmBtn" class="confirm-btn-style">EVET, ONAYLA</button>
        <button class="confirm-btn-style danger-btn" onclick="closeConfirmModal()">VAZGEÃ‡</button>
    </div>

    <script>
        let pendingAction = { type: null, data: null };

        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.getElementById('tab-' + tabName).classList.add('active');
        }

        // Firebase'den kullanÄ±cÄ±larÄ± canlÄ± Ã§ekme
        function listenUsers() {
            db.ref('users').on('value', (snapshot) => {
                const users = snapshot.val();
                const userDisplay = document.getElementById('userListDisplay');
                const blacklistDisplay = document.getElementById('blacklistDisplay');
                
                userDisplay.innerHTML = "";
                blacklistDisplay.innerHTML = "";

                if (!users) {
                    userDisplay.innerHTML = "KullanÄ±cÄ± yok.";
                    return;
                }

                Object.values(users).forEach(u => {
                    // Online KontrolÃ¼ (Son 5 dakika)
                    const isOnline = (new Date().getTime() - u.lastSeen) < 300000;

                    // EÄŸer banlÄ± deÄŸilse (role === 'banned' deÄŸilse)
                    if (u.role !== 'banned') {
                        userDisplay.innerHTML += `
                        <div class="card">
                            <div class="user-info-box">
                                <div>
                                    <span class="status-dot ${isOnline ? 'status-online' : 'status-offline'}"></span>
                                    <strong>${u.name}</strong> 
                                    ${u.role === 'admin' ? '<span style="color:yellow; border:1px solid yellow; padding:2px; font-size:10px;">ADMIN</span>' : ''}
                                </div>
                                <div style="font-size:11px; color:#666;">
                                    Son GiriÅŸ: ${u.lastLogin} | Kod: ${u.recoveryCode}
                                </div>
                            </div>
                            <div style="display:flex; gap:10px;">
                                ${u.role !== 'admin' ? `<button class="btn btn-admin" onclick="openConfirm('admin', '${u.name}')">ADMÄ°N VER</button>` : ''}
                                <button class="btn btn-ban" onclick="openConfirm('ban', '${u.name}')">BANLA</button>
                            </div>
                        </div>`;
                    } else {
                        // BanlÄ±lar sekmesine ekle
                        blacklistDisplay.innerHTML += `
                        <div class="card" style="border-left: 4px solid red;">
                            <span>ðŸš« ${u.name}</span>
                            <button class="btn btn-white" onclick="unbanUser('${u.name}')">BAN KALDIR</button>
                        </div>`;
                    }
                });
            });
        }

        function openConfirm(type, data) {
            pendingAction = { type, data };
            document.getElementById('confirmModal').style.display = 'flex';
            document.getElementById('modalTitle').innerText = `${data} iÃ§in ${type} iÅŸlemi yapÄ±lsÄ±n mÄ±?`;
            
            document.getElementById('modalConfirmBtn').onclick = () => {
                if (type === 'admin') {
                    db.ref('users/' + data).update({ role: 'admin' });
                } else if (type === 'ban') {
                    db.ref('users/' + data).update({ role: 'banned' });
                }
                closeConfirmModal();
            };
        }

        function unbanUser(username) {
            db.ref('users/' + username).update({ role: 'user' });
        }

        function closeConfirmModal() {
            document.getElementById('confirmModal').style.display = 'none';
        }

        window.onload = listenUsers;
    </script>
</body>
</html>
